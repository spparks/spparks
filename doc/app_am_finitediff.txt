"SPPARKS WWW Site"_sws - "SPPARKS Documentation"_sd - "SPPARKS Commands"_sc :c

:link(sws,http://spparks.sandia.gov)
:link(sd,Manual.html)
:link(sc,Section_commands.html#comm)

:line

app_style am/finitediff command :h3

[Syntax:]

app_style am/finitediff nspins velocity time_step path_file spot_x_deviation spot_y_deviation spot_z_deviation short_pause_time flux_prefactor substrate_height nsmooth dx :pre

nspins = number of spins/grain IDs
vel = Velocity of laser travel (meters/second)
time_step = Finite difference solver timestep (seconds)
path_file = Name of the input file with the scan path
spot_x_deviation = X-direction standard deviation for the Gaussian laser source (meters)
spot_y_deviation = Y-direction standard deviation for the Gaussian laser source (meters)
spot_z_deviation = Z-direction standard deviation for the Gaussian laser source (meters)
short_wait_time = How long to turn the laser off between rasters within a layer, estimated by laser "jump" speed * distance (seconds)
flux_prefactor = Total absorbed laser power, typically less than incident laser power due to losses (Watts)
substrate_height = Baseplate thickness (voxels)
nsmooth = How many Potts smoothing steps to perform after a site solidifies 
dx = Lattice spacing (meters) :ul

[Examples:]

app_style am/finitediff 1000000 1.4 7e-7 "path.txt" 6e-5 6e-5 6e-5 2e-7 115 18 1 5e-6 :pre

[Description:]

This is an on-lattice application for the simulation of microstructure
formation during powder bed metal additive manufacturing (AM). Unlike
the Potts model-based solidification applications in SPPARKS, this
application uses material specific solidification parameters along
with a finite-difference based thermal diffusion model. Thus, this
application can be tailored to specific materials and processes but
requires more computational resources due to the finite-difference
solver. The application is capable of simulating complex raster
patterns and boundary effects.

The examples/additive_thermal directory illustrates use of this
application and its extra commands listed below.

The "Potts"_app_potts.html portion of the model is used to simulate
solid-state grain growth after solidification. A Potts-like approach
is also used to assign grain membership after solidification.  The
number of these "smoothing" steps is defined by the {nsmooth}
setting. Further details about the solidification and finite
difference model are described in "Rodgers et al."_#Rodgers.

The {path_file} argument specifies the laser raster pattern.  The
path_file is a text file with five columns: x,y,z coordinates, total
distance traveled, and a laser on/off flag.  The path_file can either
be created by hand (an example RasterMaker.py script is provided in
the examples) or by adapting G-Code generated by a slicer program (an
example GCodeToPath.py script is also provided in the
examples). Coordinates and distances specified in the path file are in
units of lattice sites (not meters). When the simulation reaches the
end of the path file, laser flux is set to zero.  If a simulation ends
before completing the specified path, the remaining path is output in
a file named "restart_path.txt".  This is useful for restarting a long
simulation.

The model uses many material and process-specific parameters that can
be defined by additional commands and are listed below with their
default values.  If no parameters are defined, default values for 304L
stainless steel from "Johnson et al."_#Johnson are used. The
"specific_heat" and "solid_front_commands" are multi-value inputs that
respectively define piecewise-linear and polynomial functions.

The model uses real, dimensional length-scales.  Lattice spacing is
assumed to be equal in the x,y,z directions and is defined with the
"lattice"_lattice.html command. The finite difference solver's
stability is dependent upon the lattice spacing and time_step used.
These values should generally satisfy the von Neumann stability
criterion, (k*dt)/dx^2 < 1/2, where k is thermal conductivity. To
further ensure stability of the thermal solver as well as physical
accuracy, the laser path should be specified to provide a buffer
distance from the simulation domain boundaries of at least ~10 lattice
sites. A larger buffer may be required due to the lattice spacing or
melt pool dimensions.

In an AM build, the laser heat source is typically turned off as the
laser moves between rasters within a layer and between layers during
recoating cycles.  The {short_wait_time} parameter defines how long
the laser is turned off within a layer and is typically on the order
of microseconds. Recoating time is implemented by waiting until the
maximum temperature in the domain is below the liquidus and then "fast
forwarding" to the next layer. This avoids simulation of the entire
experimental recoating time, which is on the order of seconds.

As with other SPPARKS apps, the total simulation time is defined by
the "run"_run.html command in the input file.  This run time is
independent of the time required to complete the laser pattern
specified by the path_file.  The simulation run time can be estimated
by dividing the final total distance traveled (via the path_file
specification) by the laser velocity. The actual run time will be
slightly greater than this value due to the wait times between rasters
and layers.

:line

The following additional commands are defined by this application.
The command name is to the left of the equal sign.  These all take a
single argument which is a numeric value in the specified units.

k_solid                 = Solid conductivity (in W/(mK))
k_powder                = Powder conductivity (in W/(mK))
boundary_temperature    = Simulation volume boundary temperature (in K)
latent_heat             = Latent heat (in Kelvin)
density                 = Use a value between full-solid density and powder density (in kg/m^3)
t_room                  = T_room and T_inf for convection/radiation BCs (in Kelvin)
emissivity              = Combined emissivity and stefan boltzmann constant
convection_coefficient  = Convection coefficient (in W/m^2 K)
Ko                      = Grain coarsening pre-factor
Q                       = Grain coarsening exponent
liquidus                = Liquidus temperature (in Kelvin)
solidus                 = Solidus temperature (in Kelvin)
nucleation_density      = Nucleation site density (in number/m^3)
critical_undercooling   = Center of normal distribution that defines undercooling where nucleation starts (in Kelvin)
undercooling_deviation  = Std deviation of critical undercooling distribution (in Kelvin).
mean_nuclei_volume      = Center of normal distribution that defines nuclei size (in m^3)
nuclei_volume_deviation = Std dev of nuclei size distribution (in m^2) :ul

The last two commands defined by this app take multiple arguments.
Examples are shown.

specific_heat           6 300 480 600 550 1400 675 1550 693 1650 714 1750 736
solid_front_vel         4 1.091e-5 -2.034e-4 2.74e-3 1.151e-4 :pre

The specific_heat command defines a piecewise-linear fomula for how
the specific heat depends on temperature.  The first argument is the
number of pairs of values which follow.  In each pair, the first value
is temperature (in Kelvin) and the second value is specific heat (in
J/kg).  The example shown defines specific heats across a range of
temperatures from 300K to 1750K.

The solid_front_vel command defines a polynomial which is used to
calculate the velocity of the solidification front as a function of
temperature.  The first argument is the number of terms in the
polynomical, The remaining arguments are their coefficients from the
highest-order term to the lowest-order (constant) term.  In the
example shown it is a cubic polynomial where 1.091e-5 is the
coefficient on the cubic temperature, and 1.151e-4 is the constant
term.  The units of velocity are (m/s).

:line

[Restrictions:] :link(restriction)

This application is only compatible with square cubic lattices. 

This application can only be evolved by a rejection KMC (rKMC)
algorithm.  See the "sweep"_sweep.html command for more details.

Due to the global nature of the finite difference method, this
application cannot be used with stitch-based domain
decomposition. However, the "set stitch"_set.html and "dump
stitch"_dump.html commands can be used to read/write the entire
simulation domain.

[Related commands:]

"app_style potts/weld"_app_potts_weld.html, "app_style
potts/weld/jom"_app_potts_weld_jom.html, "app_style
potts/additive"_app_potts_additive.html, "app_style
potts"_app_potts.html

[Default:] 

These are the default settings:

k_solid                 30
k_powder                0.3
boundary_temperature    300
specific_heat           6 300 480 600 550 1400 675 1550 693 1650 714 1750 736
latent_heat             285000
density                 5706
t_room                  300
emissivity              1
convection_coefficient  25
Ko                      0.0000204133
Q                       128312
liquidus                1723
solidus                 1673
solid_front_vel         4 1.091e-5 -2.034e-4 2.74e-3 1.151e-4
nucleation_density      1e14
critical_undercooling   5
undercooling_deviation  3
mean_nuclei_volume      8.4375e-16
nuclei_volume_deviation 1.5625e-17 :ul

:line

:link(Rodgers)
[(Rodgers)] T.M. Rodgers, D. Moser, F. Abdeljawad, O.D. Underwood
Jackson, J.D. Carroll, B.H. Jared, D.S. Bolintineanu, J.A. Mitchell,
J. D.Madison, "Simulation of Powder Bed Metal Additive Manufacturing
Microstructures with Coupled Finite Difference-Monte Carlo Method",
Additive Manufacturing (2021).

:link(Johnson)
[(Johnson)] K.L. Johnson, T.M. Rodgers, O.D. Underwood, J.D. Madison,
K.R. Ford, S.R. Whetten, D.J. Dagel, J.E. Bishop, "Simulation and
experimental comparison of the thermo-mechanical history and 3D
microstructure evolution of 304L stainless steel tubes manufactured
using LENS", Computational Mechanics (2018).
